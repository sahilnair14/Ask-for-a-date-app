name: Deploy to IIS via FTP

on:
  push:
    branches:
      - main  # Trigger the action on push to the 'main' branch

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Install Node.js dependencies
      uses: actions/setup-node@v3
      with:
        node-version: '18.x'
        
    - run: npm install

    - name: Build the app (if needed)
      run: npm run build

    - name: Upload to IIS via FTP
      uses: SamKirkland/FTP-Deploy-Action@4.4.0
      with:
        ftp-server: ${{ secrets.FTP_SERVER }}
        ftp-username: ${{ secrets.FTP_USERNAME }}
        ftp-password: ${{ secrets.FTP_PASSWORD }}
        local-dir: './'  # Directory to upload
        server-dir: ${{ secrets.FTP_PATH }}  # Directory on the server

    - name: Restart IIS App Pool
      run: |
        curl -u "${{ secrets.FTP_USERNAME }}:${{ secrets.FTP_PASSWORD }}" ftp://${{ secrets.FTP_SERVER }}
